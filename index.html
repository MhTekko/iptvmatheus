<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Catálogo M3U8 - ManoTV</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
</head>
<body>
  <div class="app-container">
    <!-- Sidebar esquerda -->
    <aside class="sidebar">
      <h2>CANAIS</h2>

    

      <!-- Nova barra de pesquisa -->
      <input
        type="text"
        id="searchInput"
        placeholder="Pesquisar canais..."
        oninput="filterChannels()"
        style="width: 100%; padding: 5px; margin: 10px 0;"
      />

      <div id="channelList" class="channel-list"></div>
    </aside>

    <!-- Conteúdo principal -->
    <main class="main-content">
      <h1>REPRODUZINDO AGORA</h1>
      <video id="video" controls autoplay></video>
    </main>
  </div>

  <script>
    let channels = []; // Array global para armazenar os canais carregados

    // URL escondida dentro do código
    const m3u8Url = "https://raw.githubusercontent.com/ManoLimah/Manoteste/refs/heads/main/ManoTV.m3u";

    async function loadM3U8() {
      try {
        const response = await fetch(m3u8Url);
        const text = await response.text();
        const lines = text.split('\n');

        channels = []; // limpa antes de carregar

        for (let i = 0; i < lines.length; i++) {
          if (lines[i].startsWith('#EXTINF')) {
            const title = lines[i].split(',')[1] || 'Sem Título';
            const streamUrl = lines[i + 1];
            channels.push({ title, streamUrl });
          }
        }

        displayChannels(channels);
      } catch (error) {
        alert('Erro ao carregar o arquivo .m3u8. Verifique a URL.');
      }
    }

    function displayChannels(list) {
      const channelList = document.getElementById('channelList');
      channelList.innerHTML = '';

      list.forEach(({ title, streamUrl }) => {
        const channelItem = document.createElement('div');
        channelItem.className = 'channel-item';
        channelItem.textContent = title;
        channelItem.onclick = () => playStream(streamUrl);
        channelList.appendChild(channelItem);
      });
    }

    function filterChannels() {
      const filter = document.getElementById('searchInput').value.toLowerCase();
      const filtered = channels.filter(channel => channel.title.toLowerCase().includes(filter));
      displayChannels(filtered);
    }

    function playStream(url) {
      const video = document.getElementById('video');
      if (Hls.isSupported()) {
        const hls = new Hls();
        hls.loadSource(url);
        hls.attachMedia(video);
        hls.on(Hls.Events.MANIFEST_PARSED, () => video.play());
      } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
        video.src = url;
        video.addEventListener('loadedmetadata', () => video.play());
      } else {
        alert('Seu navegador não suporta HLS (.m3u8).');
      }
    }

    // Carrega automaticamente ao abrir a página
    window.onload = loadM3U8;
  </script>
</body>
</html>
